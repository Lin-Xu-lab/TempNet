# Introduction

TempNet is a deep learning framework designed to integrate and align time-series single-cell omics data. TempNet encodes single-cell omics data to produce a highly informative latent space embedding that supports clustering, visualization, and downstream analyses. 
![Fig](/Image/model_diagram.png) 
# Input data

Each sample or temporal stage should have two files: 
```
- a counts file (sample1.cnt.csv)
- a metadata file (sample1.meta.csv)
```

When the data are loaded, files of the sample type are concatenated together across samples. This means that it is okay if your data are already combined into a single counts file and a single metadata file.

## 1) Metadata files (.meta.csv)
```
- The rows are cells and the columns are important characteristics (e.g., time_point, cell_type, sample_id). 
- The first column in the metadata file should be the unique cell IDs
- When the metadata is loaded, the cell IDs become the index and are used to match cells to their corresponding count data. 
```
## 2) Count files (.cnt.csv)
```
- The rows are genes and columns are cells. The values can be processed data or raw counts.
- If the `--do_preprocess` flag is given to the bash script, the `sc_preprocess` function will process the raw count data using the standard Scanpy pipeline (i.e., normalize, log transform, scale) and 
```

# Running the pipeline
You can execute main python training loop (`TempNet_train.py`) with the bash script `run_TempNet.sh` and specify your desired parameters. A full list of arguments is available near the top of the `TempNet_train.py`. 

The `run_TempNet_rev.sh` script is a more detailed example specifying more arguments, including the addition of the flag to use gradient reversal (`--use_rev`).

Key arguments:
- `--data_dir`: Directory with the .meta.csv and .cnt.csv files 
- `--temporal_key`: Column name in the metadata that corresponds to the temporal stage identifier (e.g., stage or time_point)
- `--temporal_labels`: List of strings that indicate the unique temporal classifications in their correct order (e.g., day_0, day_5, day_10)
- `--predictor_key`: Column name in the metadata that will be used with the predictor for simple classification (e.g., cell_type) or label mixing with gradient reversal (e.g., sample or omics)
- `--do_preprocess`: Whether to pre-process the count data with the standard Scanpy pipeline (see `sc_preprocess` function in `TempNet_utils.py` for details)
- `--use_rev`: Whether to use gradient reversal for the predictor submodel. Using gradient reversal will counteract the simple classifications of the predictor. For example, if you use a predictor_key like "sample", applying gradient reversal will discourage the model from learning to distinguish samples.
- `--save_model`: Whether to save the encoder and predictor models as well as their `.state_dict()`
- `--save_dir`: Directory where the TempNet embeddings will be saved

Other arguments provide flexibility for model hyperparameters, such as the dimensionality of the latent space embedding or the relative weights of different components of the loss function. 

# Model outputs and visualization

The main output of TempNet is a low-dimensional embedding of all input data generated by the trained encoder. `TempNet_train.py` saves csv files from the final AnnData object of the model embedding. `X.csv` corresponds to the embedding, and `obs.csv` contains relevant metadata.

The `plot_umap` function in `TempNet_utils.py` will visualize the embedding using scanpy and matplotlib functions. This function is already called at the end of the main training funtion `TempNet_train.py`, and the image should save to the same location as the embedding. 

# 4. Contact information

Please contact our team if you have any questions:
```
Alexa Hassien (Alexa.Hassien@utsouthwestern.edu)
Xue Xiao (Xiao.Xue@UTSouthwestern.edu)
Yuansheng Zhou (Yuansheng.Zhou@UTSouthwestern.edu)
Lin Xu (Lin.Xu@UTSouthwestern.edu)
```
Please contact Alexa Hassien or Xue Xiao for programming questions about the *.py

# Copyright information 

Please see the "LICENSE" file for the copyright information.
